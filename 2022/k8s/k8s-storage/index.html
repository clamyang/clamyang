<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="ä¸€ç‰©ä¸çŸ¥æ·±ä»¥ä¸ºè€»"><title>k8s å­˜å‚¨å†…å®¹ | æ¨å®å¼ºçš„æŠ€æœ¯ç¬”è®°</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">k8s å­˜å‚¨å†…å®¹</h1><a id="logo" href="/.">æ¨å®å¼ºçš„æŠ€æœ¯ç¬”è®°</a><p class="description">Gopher Watcher</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">k8s å­˜å‚¨å†…å®¹</h1><div class="post-meta">2022-07-05</div><div class="post-content"><p>æ¦‚è¿° k8s å­˜å‚¨ç›¸å…³çŸ¥è¯†ç‚¹ã€‚</p>
<span id="more"></span>

<h2 id="Volume-æ¦‚å¿µ"><a href="#Volume-æ¦‚å¿µ" class="headerlink" title="Volume æ¦‚å¿µ"></a>Volume æ¦‚å¿µ</h2><p>ç‰©ç†æœºä¸Šå¤§å®¶å…±ç”¨åŒä¸€å¥—æ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯åœ¨å®¹å™¨å†…ï¼Œæ¯ä¸ªå®¹å™¨çš„é•œåƒéƒ½æä¾›äº†ä¸€å¥—æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒä»¬ä¹‹é—´ä¹‹ç›¸äº’ç‹¬ç«‹çš„ã€‚å®¹å™¨è¿è¡Œæ—¶å¯ä»¥å¯¹ç³»ç»Ÿä¸­çš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯å½“ä»–ä»¬è¿è¡Œç»“æŸåï¼Œcontainer è¢«é”€æ¯äº†ï¼ˆè¿›ç¨‹æ²¡äº†ï¼Œè¿›ç¨‹ä¸­çš„å†…å®¹ä¹Ÿä¸ä¼šå­˜åœ¨äº†ï¼‰ï¼Œä»–ä¿®æ”¹çš„ä¸œè¥¿ä¹Ÿå°±éƒ½æ²¡äº†</p>
<p>æƒ³è®©æ•°æ®æŒä¹…å­˜å‚¨çš„æ–¹æ³•å°±æ˜¯ç»™ POD æŒ‚è½½å·ï¼Œç»‘å®šåˆ° POD å†…çš„å®¹å™¨ä¸­ã€‚æ‰€ä»¥ä¸è¦å†å‚»å‚»çš„ä»¥ä¸ºå·æ˜¯æŒ‚ç»™ POD çš„ï¼Œä¸¥æ ¼çš„è¯´æ˜¯æŒ‚è½½ç»™è¿è¡Œä¸­çš„å®¹å™¨ã€‚</p>
<img src="https://s2.loli.net/2022/07/04/ybZlBV1AJSiQv7R.png" style="zoom:80%;" />

<p>ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æåˆ°çš„éƒ½æ˜¯å®¹å™¨é‡å¯ï¼Œç°æœ‰çš„æ–¹æ¡ˆå¯ä»¥è§£å†³å®¹å™¨é‡å¯åæ•°æ®ä¸¢å¤±çš„é—®é¢˜ï¼Œé‚£ä¹ˆå¦‚ä¸Šå›¾ä¸­çš„ç»“æ„ï¼ŒPod è¿›è¡Œé‡å¯åï¼Œæ•°æ®è¿˜å¯ä»¥è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨å—ï¼Ÿ</p>
<p><strong>ä¸èƒ½çš„</strong> ï¼Œåœ¨ä¸Šå›¾ä¸­ï¼ŒVolume å’Œ Pod æ˜¯å…±äº«ç”Ÿå‘½å‘¨æœŸçš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§èƒ½å¤Ÿç‹¬ç«‹äº Pod  ç”Ÿå‘½å‘¨æœŸçš„å­˜å‚¨ç±»åˆ«ã€‚</p>
<h2 id="External-Storage-Volume"><a href="#External-Storage-Volume" class="headerlink" title="External Storage Volume"></a>External Storage Volume</h2><p>å¤–éƒ¨å­˜å‚¨ï¼Œç‹¬ç«‹äº Pod çš„ç”Ÿå‘½å‘¨æœŸã€‚å³ä½¿ Pod è¢«è°ƒåº¦åˆ°äº†å…¶ä»–çš„å·¥ä½œèŠ‚ç‚¹ï¼Œä¾ç„¶å¯ä»¥è¿æ¥åˆ°æˆ‘ä»¬çš„å¤–éƒ¨å­˜å‚¨å·ï¼Œç›¸æ¯”äº hostpath çš„å¥½å¤„ã€‚</p>
<p><img src="https://s2.loli.net/2022/07/04/2a1bxNSVTweWKns.png"></p>
<p>å¸¸è§çš„å·ç±»å‹ï¼š</p>
<ul>
<li>hostPath ç‹¬ç«‹äº Pod ç”Ÿå‘½å‘¨æœŸ</li>
<li>emptyDir ä¸ Pod ç”Ÿå‘½å‘¨æœŸç›¸åŒ</li>
<li>gcePersistentDisk Google çš„æŒä¹…å·</li>
<li>cephfs </li>
<li>configMap ä¸€èˆ¬ç”¨äºæŒ‚è½½æ–‡ä»¶çš„ï¼Œé€šå¸¸æ˜¯é…ç½®æ–‡ä»¶</li>
<li>secret ä¸€èˆ¬ç”¨äºå­˜å‚¨é‡è¦ä¿¡æ¯</li>
</ul>
<p>é—®é¢˜ï¼š <strong>å½“ä»¥ read/write æ¨¡å¼æŒ‚è½½å·çš„æ—¶å€™</strong>ï¼Œè¿™æ—¶éœ€è¦æ‰©å±•åˆ°å¤šä¸ª Podï¼Œæ–°çš„ Pod åˆ›å»ºä¸å‡ºæ¥çš„ã€‚read/write æ¨¡å¼ä¸‹çš„å·åªèƒ½ç»™ä¸€ä¸ª Pod æŒ‚è½½ï¼Œ read-only å¯ä»¥åŒäº‹æŒ‚è½½ç»™å¤šä¸ª Podã€‚</p>
<h2 id="PV"><a href="#PV" class="headerlink" title="PV"></a>PV</h2><p>é¡¾åæ€ä¹‰ï¼ŒPersistentVolume å¯¹è±¡ä»£è¡¨ä¸€ä¸ªç”¨äºæŒä¹…åŒ–åº”ç”¨ç¨‹åºæ•°æ®çš„å­˜å‚¨å·ã€‚æ²¡æœ‰è®² PV å¯¹è±¡å‰ï¼Œæˆ‘ä»¬æŒ‚è½½å¤–éƒ¨å­˜å‚¨çš„çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šå…·ä½“çš„å­˜å‚¨ç±»åˆ«ï¼Œæ¯”å¦‚ä½¿ç”¨ Google çš„å­˜å‚¨å·ï¼Œå½“æˆ‘ä»¬éœ€è¦å°† Pod éƒ¨ç½²åˆ° AWS ä¸­çš„é›†ç¾¤æ—¶ï¼Œå°±éœ€è¦é‡æ–°ä¿®æ”¹è¿™ä¸ª YAML æ–‡ä»¶ã€‚</p>
<p><img src="https://s2.loli.net/2022/07/04/DhfS5CRILcmW9se.png"></p>
<p>PV æ˜¯ K8s æä¾›ç»™æˆ‘ä»¬çš„æŠ½è±¡ï¼Œåœ¨ Pod å’Œåº•å±‚å­˜å‚¨æŠ€æœ¯ä¹‹é—´è§£è€¦ã€‚</p>
<p><img src="https://s2.loli.net/2022/07/04/71qz5ZdxpjWGIeF.png"></p>
<h3 id="æ‰‹åŠ¨é…ç½®çš„-PV-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#æ‰‹åŠ¨é…ç½®çš„-PV-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ‰‹åŠ¨é…ç½®çš„ PV çš„ç”Ÿå‘½å‘¨æœŸ"></a>æ‰‹åŠ¨é…ç½®çš„ PV çš„ç”Ÿå‘½å‘¨æœŸ</h3><p><img src="https://s2.loli.net/2022/07/05/I8RzS5uBNakKAs3.png"></p>
<ol>
<li>ç°æœ‰é…ç½®å¥½åº•å±‚å­˜å‚¨</li>
<li>åˆ›å»º PV å¯¹è±¡ï¼ŒæŒ‡å‘åº•å±‚å­˜å‚¨ï¼ŒPV çŠ¶æ€ä¸º Available</li>
<li>åˆ›å»º PVC æŒ‡å‘åˆšåˆšåˆ›å»ºçš„ PV, PVC â€“ PV ç»‘å®šåˆ°ä¸€èµ·</li>
<li>åˆ é™¤ PVCï¼Œ PVC â€“ PV ä¹‹é—´è§£ç»‘ï¼ŒPV çŠ¶æ€ä¸º Released</li>
<li>é‡æ–°åˆ›å»º PV å¯ä½¿ PV çŠ¶æ€å˜æˆ Available</li>
</ol>
<h2 id="PVC"><a href="#PVC" class="headerlink" title="PVC"></a>PVC</h2><p>Pod å¹¶ä¸ä¼šç›´æ¥å¼•ç”¨ PVï¼Œè€Œæ˜¯é€šè¿‡ PVC ï¼Œç„¶å PVC å†å¯¹åº”ä¸€ä¸ª PV çš„æ–¹å¼ï¼Œæ­£å¦‚ä¸Šå›¾æè¿°çš„ï¼Œä½¿ç”¨ PV PVC çš„æœ€å¤§å¥½å¤„å°±æ˜¯å°†ç‰¹å®šäºåº•å±‚å­˜å‚¨çš„ç»†èŠ‚ä¸ pod æ‰€ä»£è¡¨çš„åº”ç”¨ç¨‹åºåˆ†ç¦»ã€‚</p>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><img src="https://s2.loli.net/2022/07/04/dMFyi8ncsQLl3o6.png"></p>
<p>ä»è¿™å¼ å›¾å¯ä»¥çœ‹å‡ºï¼ŒPV æ˜¯ç»™é›†ç¾¤ç®¡ç†å‘˜ä½¿ç”¨çš„ï¼ŒPVC æ˜¯ç»™ç”¨æˆ·ä½¿ç”¨çš„ã€‚å¦‚æœå®‰è£…äº†åŠ¨æ€åˆ†é…çš„æ’ä»¶ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é€šè¿‡åˆ›å»º PVC çš„æ–¹å¼ã€‚</p>
<p>å·çš„è®¿é—®æ–¹å¼ï¼š</p>
<table>
<thead>
<tr>
<th>Access Mode</th>
<th>Abbr.</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>ReadWriteOnce </code></td>
<td><code>RWO </code></td>
<td>The volume can be mounted by a single worker node in read/write mode. While itâ€™s mounted to the node, other nodes canâ€™t mount the volume.</td>
</tr>
<tr>
<td><code>ReadOnlyMany </code></td>
<td><code>ROX </code></td>
<td>The volume can be mounted on multiple worker nodes simultaneously in read-only mode.</td>
</tr>
<tr>
<td><code>ReadWriteMany </code></td>
<td><code>RWX </code></td>
<td>The volume can be mounted in read/write mode on multiple worker nodes at the same time.</td>
</tr>
</tbody></table>
<blockquote>
<p>è¿™é‡ŒæŒ‡çš„æ˜¯ Node</p>
</blockquote>
<p>PV çš„å›æ”¶ç­–ç•¥ï¼š</p>
<table>
<thead>
<tr>
<th>Reclaim policy</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>Retain </code></td>
<td>When the persistent volume is released (this happens when you delete the claim thatâ€™s bound to it), Kubernetes <em>retains</em> the volume. The cluster administrator must manually reclaim the volume. This is the default policy for manually created persistent volumes.</td>
</tr>
<tr>
<td><code>Delete </code></td>
<td>The PersistentVolume object and the underlying storage are automatically deleted upon release. This is the default policy for dynamically provisioned persistent volumes, which are discussed in the next section.</td>
</tr>
<tr>
<td><code>Recycle </code></td>
<td>This option is deprecated and shouldnâ€™t be used as it may not be supported by the underlying volume plugin. This policy typically causes all files on the volume to be deleted and makes the persistent volume available again without the need to delete and recreate it.</td>
</tr>
</tbody></table>
<p>åŠ¨æ€åˆ†é…é»˜è®¤å›æ”¶ç­–ç•¥æ˜¯ï¼šdelete</p>
<p>æ‰‹åŠ¨åˆ›å»º PV æ—¶é»˜è®¤å›æ”¶ç­–ç•¥æ˜¯ï¼šretain</p>
<p>æˆ‘ä»¬åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä¿®æ”¹ PV çš„å›æ”¶ç­–ç•¥ï¼Œæ¯”å¦‚ä½¿ç”¨åŠ¨æ€åˆ†é…æ—¶ï¼Œé»˜è®¤å›æ”¶ç­–ç•¥æ˜¯ delete ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸­é€”ä¸æƒ³åˆ é™¤PVCçš„æ—¶å€™åˆ é™¤è¿™ä¸ªå·ï¼Œå¯ä»¥å°†å…¶ä¿®æ”¹ä¸º retainã€‚</p>
<blockquote>
<p>å¦‚æœæ˜¯ Released çŠ¶æ€çš„ PVï¼Œæˆ‘ä»¬ä¿®æ”¹å…¶å›æ”¶ç­–ç•¥ä¸º delete æ—¶ï¼Œä¿å­˜é€€å‡ºåï¼ŒPV å¯¹è±¡å’Œåº•å±‚çš„å·éƒ½ä¼šè¢«åˆ é™¤ã€‚</p>
</blockquote>
<p><img src="https://s2.loli.net/2022/07/05/TPmMsjYJBEdbHqw.png"></p>
<p>ä¸Šå›¾ä¸­æˆ‘å°† PVC åˆ æ‰äº†ï¼Œç°åœ¨ç­–ç•¥æ˜¯ Retain è¿™æ—¶å€™ <code>kubectl edit </code> ä¸€ä¸‹ä¿®æ”¹ä¸º Deleteã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">persistentVolumeReclaimPolicy: Retain --&gt; persistentVolumeReclaimPolicy: Delete</span><br></pre></td></tr></table></figure>



<p>PV çš„åˆ é™¤</p>
<p>é™¤äº†ä¸Šè¿°æƒ…å†µï¼Œå‡å¦‚æˆ‘ä»¬æƒ³åœ¨ PV æ˜¯ Bound çŠ¶æ€ä¸‹åˆ é™¤ï¼ŒPV å¯ä»¥è¢«åˆ æ‰å—ï¼Ÿ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">[root@k8s]#</span><span class="bash"> kubectl delete pv hostvol</span></span><br><span class="line">persistentvolume &quot;hostvol&quot; deleted</span><br></pre></td></tr></table></figure>

<p>ä¼šä¸€ç›´å¡åœ¨è¿™é‡Œï¼ŒCtrl-C å–æ¶ˆè¿™æ¬¡æ“ä½œï¼Œå†æ¬¡è·å– PV å‘ç°å·²ç»æ˜¯ <code>Terminating</code> çŠ¶æ€äº†ã€‚å°½ç®¡åˆšåˆšå–æ¶ˆdeleteå‘½ä»¤çš„æ‰§è¡Œï¼Œä½†æ˜¯è¿™ä¸ª delete çš„æ“ä½œä¼šè¢«è®°å½•åœ¨ K8S ä¸­ï¼ˆè¢«é‡Šæ”¾åä»ç„¶ä¼šè¢«åˆ é™¤ï¼‰ã€‚</p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬çœ‹çœ‹åˆ é™¤æŸä¸ªè¢« POD å¼•ç”¨çš„ PVC æ˜¯ä»€ä¹ˆæƒ…å†µã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@k8s]<span class="comment"># kubectl delete pvc hostpvc</span></span><br><span class="line">persistentvolumeclaim <span class="string">&quot;hostpvc&quot;</span> deleted</span><br></pre></td></tr></table></figure>

<p>ä¾ç„¶ä¼šä¸€ç›´å¡åœ¨è¿™é‡Œï¼ŒåŒåˆ é™¤ PV ä¸€æ ·ã€‚</p>
<h2 id="å¤šä¸ª-POD-æŒ‚è½½-ReadWriteOnce-å·"><a href="#å¤šä¸ª-POD-æŒ‚è½½-ReadWriteOnce-å·" class="headerlink" title="å¤šä¸ª POD æŒ‚è½½ ReadWriteOnce å·"></a>å¤šä¸ª POD æŒ‚è½½ ReadWriteOnce å·</h2><p>è¿™ä¸¤å¤©è„‘å­é‡Œä¹Ÿä¸€ç›´åœ¨æƒ³è¿™ä»¶äº‹ï¼Œæˆ‘ä»¬æŒ‚è½½ä¸€ä¸ªå¯è¯»å¯å†™çš„å·ç»™ PODï¼Œå¦‚æœè¯´è¿™æ—¶å€™éœ€è¦å¢åŠ è¿™ä¸ª POD  çš„å‰¯æœ¬ï¼Œå¤šä¸ª POD æŒ‚è½½åŒä¸€ä¸ªå¯è¯»å¯å†™çš„å·ï¼Œæ˜¯å¦å¯ä»¥æ”¯æŒï¼Ÿ</p>
<p><strong>ç­”æ¡ˆæ˜¯æ”¯æŒçš„</strong> ï¼Œä½†æ˜¯æœ‰å‰æï¼Œ  <strong>æ‰©å±•å‡ºæ¥çš„PODéƒ½å¿…é¡»åœ¨åŒä¸€ä¸ª NODE ä¸Š</strong> ï¼ŒOnce æŒ‡çš„æ˜¯æŒ‚è½½åˆ°çš„ Nodeï¼Œåªèƒ½ç»™ Node æŒ‚è½½ä¸€æ¬¡ï¼Œå¦‚æœæ‰©å±•çš„ POD è°ƒåº¦åˆ°å…¶ä»– NODEï¼ŒPOD æ˜¯èµ·ä¸æ¥çš„ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> kubectl describe po data-writer-97t9j</span></span><br><span class="line">...</span><br><span class="line">  Warning  FailedAttachVolume   ...   attachdetach-controller  AttachVolume.Attach failed </span><br><span class="line">for volume &quot;other-data&quot; : googleapi: Error 400: RESOURCE_IN_USE_BY_ANOTHER_RESOURCE -</span><br><span class="line">The disk resource &#x27;projects/.../disks/other-data&#x27; is already being used by</span><br><span class="line">&#x27;projects/.../instances/gkdp-r6j4&#x27;</span><br></pre></td></tr></table></figure>

<p>ç”±äºæˆ‘è¿™é‡Œæœºå™¨å°±ä¿©èŠ‚ç‚¹ï¼Œå¤ç°ä¸å‡ºæ¥ï¼Œç›´æ¥æŠŠä¹¦ä¸­å†…å®¹ç²˜è´´å‡ºæ¥äº†ã€‚</p>
<h2 id="åŠ¨æ€é…ç½®æŒä¹…å·"><a href="#åŠ¨æ€é…ç½®æŒä¹…å·" class="headerlink" title="åŠ¨æ€é…ç½®æŒä¹…å·"></a>åŠ¨æ€é…ç½®æŒä¹…å·</h2><p>å…ˆåˆ›å»º PV ï¼Œå†åˆ›å»º PVC çš„æ–¹å¼æœ‰äº›ç¹çï¼Œæˆ‘è¿™é‡Œé‡åˆ°è¿‡ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨å¯¹æ¥ ceph çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æƒ³åˆ›å»ºä¸€ä¸ª PV å¯¹è±¡æŒ‡å‘è¿™ä¸ªåº•å±‚çš„å·ï¼Œå½“æ—¶éœ€è¦å¡«ä¸€ä¸ª <code>volumeHandle</code> å¯¹åº”çš„å€¼ï¼Œæ˜¯ ceph å·çš„ IDã€‚å¯¹äºå¹¶ä¸çŸ¥é“æ€ä¹ˆæ“ä½œ ceph çš„æˆ‘æ¥è¯´æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œéœ€è¦å…ˆåˆ›å»ºå¥½åº•å±‚å·ï¼Œç„¶ååœ¨PVä¸­æŒ‡å®šæ‰å¯ä»¥ã€‚</p>
<p>ä½†æ˜¯ï¼Œé€šè¿‡åŠ¨æ€é…ç½®çš„æ–¹å¼å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ‰‹åŠ¨å‡†å¤‡å¥½å­˜å‚¨å·ä»¥åŠPVå¯¹è±¡ï¼Œåªéœ€å†™ä¸€ä¸ªâ€œéœ€æ±‚æ–‡æ¡£â€ã€‚</p>
<h3 id="åŠ¨æ€é…ç½®æµç¨‹"><a href="#åŠ¨æ€é…ç½®æµç¨‹" class="headerlink" title="åŠ¨æ€é…ç½®æµç¨‹"></a>åŠ¨æ€é…ç½®æµç¨‹</h3><p><img src="https://s2.loli.net/2022/07/05/rkYKoNBRMi3nUjV.png"></p>
<h3 id="StorageClass-ä¸-PVC-çš„å…³ç³»"><a href="#StorageClass-ä¸-PVC-çš„å…³ç³»" class="headerlink" title="StorageClass ä¸ PVC çš„å…³ç³»"></a>StorageClass ä¸ PVC çš„å…³ç³»</h3><p><img src="https://s2.loli.net/2022/07/11/dQRJFDbnCAuyk5x.png"></p>
<p>é€šå¸¸æ¥è®²ï¼Œä¸åŒå·ç±»å‹å¯¹åº”çš„ä¸åŒçš„åº•å±‚å­˜å‚¨æŠ€æœ¯ã€‚</p>
<h3 id="å·ç»‘å®šæ¨¡å¼"><a href="#å·ç»‘å®šæ¨¡å¼" class="headerlink" title="å·ç»‘å®šæ¨¡å¼"></a>å·ç»‘å®šæ¨¡å¼</h3><p>è®²çš„å°±æ˜¯æˆ‘ä»¬åˆ›å»º PVC å¯¹è±¡åï¼ŒPV  ä½•æ—¶è¢«åˆ›å»ºã€‚</p>
<table>
<thead>
<tr>
<th>Volume binding mode</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>Immediate </code></td>
<td>The provision and binding of the persistent volume takes place immediately after the claim is created. Because the consumer of the claim is unknown at this point, this mode is only applicable to volumes that are can be accessed from any cluster node.</td>
</tr>
<tr>
<td><code>WaitForFirstConsumer </code></td>
<td>The volume is provisioned and bound to the claim when the first pod that uses this claim is created. This mode is used for topology-constrained volume types.</td>
</tr>
</tbody></table>
<p>éœ€è¦ <code>WaitForFirstConsumer </code> çš„åŸå› æ˜¯ï¼Œä½¿ç”¨ Local è¿™ç§å·ç±»å‹çš„æ—¶å€™ï¼Œä¸çŸ¥é“ POD è¢«è°ƒåº¦åˆ°å“ªé‡Œï¼Œæ‰€ä»¥éœ€è¦ç¡®å®šå¥½ POD ä½ç½®åå†åˆ›å»º PVã€‚</p>
<h3 id="åŠ¨æ€ç»‘å®šçš„å£°æ˜å‘¨æœŸ"><a href="#åŠ¨æ€ç»‘å®šçš„å£°æ˜å‘¨æœŸ" class="headerlink" title="åŠ¨æ€ç»‘å®šçš„å£°æ˜å‘¨æœŸ"></a>åŠ¨æ€ç»‘å®šçš„å£°æ˜å‘¨æœŸ</h3><p><img src="https://s2.loli.net/2022/07/06/5ABInxbTrwCLl7v.png"></p>
<h3 id="å·æ‰©å®¹"><a href="#å·æ‰©å®¹" class="headerlink" title="å·æ‰©å®¹"></a>å·æ‰©å®¹</h3><p>éœ€è¦ POD é…åˆï¼ˆé‡å¯ï¼‰æ¥å®Œæˆã€‚</p>
<h3 id="Retain-çŠ¶æ€çš„-PV-æ€ä¹ˆæ¢å¤ä¸º-Available"><a href="#Retain-çŠ¶æ€çš„-PV-æ€ä¹ˆæ¢å¤ä¸º-Available" class="headerlink" title="Retain çŠ¶æ€çš„ PV æ€ä¹ˆæ¢å¤ä¸º Available"></a>Retain çŠ¶æ€çš„ PV æ€ä¹ˆæ¢å¤ä¸º Available</h3><p>æœ¬æ¥ä»¥ä¸º k8s å¯¹æ¥æŒä¹…åŒ–å­˜å‚¨å·²ç»ç»“æŸäº†ï¼Œçªç„¶å‘ç° Rancher ä¸Šå¹¶ä¸æ”¯æŒï¼Œä¿®æ”¹ PV çš„å±æ€§ã€‚æƒ³è¦ä» Retain çŠ¶æ€ä¿®æ”¹ä¸º Available æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>é‡æ–°åˆ›å»ºè¿™ä¸ª PV å¯¹è±¡</li>
<li>edit è¿™ä¸ª PV å¯¹è±¡åˆ é™¤ claimref éƒ¨åˆ†</li>
</ul>
<p><img src="https://s2.loli.net/2022/07/11/4JN2AMPanYqQ3bV.png"></p>
<p> å°† PVC å¯¹è±¡é‡Šæ”¾åï¼Œè·å–åˆ°çš„ PV åˆ—è¡¨ï¼Œæ—¢ç„¶ Rancher ä¸æ”¯æŒï¼Œåªèƒ½å¦å¯»ä»–è·¯äº†ã€‚</p>
<blockquote>
<p><strong>delete and recreate pv object ä¼šå¯¼è‡´åº•å±‚å·è¢«åˆ é™¤å—ï¼Ÿ</strong></p>
<p>å…ˆåˆ›å»º PV å†åˆ›å»º PVC çš„æ–¹å¼å¹¶ä¸ä¼šåˆ é™¤ï¼Œåº•å±‚å­˜å‚¨ã€‚</p>
<p>åŠ¨æ€åˆ›å»ºçš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„å›æ”¶ç­–ç•¥åŒºåˆ†ï¼š</p>
<ul>
<li>deleteï¼Œpvc è¢«åˆ é™¤å pv å’Œåº•å±‚å­˜å‚¨å·éƒ½è¢«åˆ é™¤</li>
<li>retainï¼Œpvc è¢«åˆ é™¤åï¼Œpv æ˜¯ released çŠ¶æ€ ï¼ˆTODO éœ€è¦è°ƒç ”ä¸€ä¸‹ï¼‰</li>
</ul>
</blockquote>
</div><div id="donate"><link rel="stylesheet" type="text/css" href="/css/donate.css?v=1.0.0"><script type="text/javascript" src="/js/donate.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸ!"></script><a class="pos-f tr3" id="github" href="https://github.com/clamyang" target="_blank" title="Github"></a><div id="DonateText">Donate</div><ul class="list pos-f" id="donateBox"><li id="AliPay" qr="/img/AliPayQR.jpg"></li><li id="WeChat" qr="/img/WeChatQR.jpg"></li></ul><div class="pos-f left-100" id="QRBox"><div id="MainBox"></div></div></div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸ!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>k8s å­˜å‚¨å†…å®¹</p><p><span>æ–‡ç« ä½œè€…ï¼š</span>bqyang</p><p><span>å‘å¸ƒæ—¶é—´ï¼š</span>2022-07-05</p><p><span>æœ€åæ›´æ–°ï¼š</span>2022-07-11</p><p><span>åŸå§‹é“¾æ¥ï¼š</span><a href="/2022/k8s/k8s-storage/">https://bqyang.top/2022/k8s/k8s-storage/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://bqyang.top/2022/k8s/k8s-storage/"></i></span></p><p><span>ç‰ˆæƒå£°æ˜ï¼š</span>The author owns the copyright, please indicate the source reproduced.</p></div><br><div class="tags"></div><div class="post-nav"><a class="pre" href="/2022/os/pstree/">ç®€æ˜“ç‰ˆ pstree</a><a class="next" href="/2022/design-pattern/Structural/facade/">é—¨é¢æ¨¡å¼ï¼ˆå¤–è§‚æ¨¡å¼ï¼‰</a></div><script src="https://utteranc.es/client.js" repo="clamyang/blogs" issue-term="title" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://bqyang.top"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/socket/">ä½¿ç”¨ C æ­å»º Server</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/epoll/">epoll æ–‡æ¡£ç¿»è¯‘</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/k8s/k8s/">æ­å»º Kubernetes é›†ç¾¤</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/language/golang/large-alloc/">Go å¤§å¯¹è±¡åˆ†é…æ¢ç´¢</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/language/golang/memory-alloc/">Go å†…å­˜åˆ†é…å™¨</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/os/memory/free-space-manage/">free space management</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/k8s/k8s-storage-source-code/">k8s pv pvc æºç </a></li><li class="post-list-item"><a class="post-list-link" href="/2022/design-pattern/Structural/composite/">ç»„åˆæ¨¡å¼</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/os/pstree/">ç®€æ˜“ç‰ˆ pstree</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/k8s/k8s-storage/">k8s å­˜å‚¨å†…å®¹</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="http://www.xargin.com/" title="Xargin" target="_blank">Xargin</a><ul></ul><a href="https://mytechshares.com/" title="è‘£æ³½æ¶¦çš„æŠ€æœ¯ç¬”è®°" target="_blank">è‘£æ³½æ¶¦çš„æŠ€æœ¯ç¬”è®°</a><ul></ul><a href="https://hujingnb.com/" title="çƒŸè‰çš„é¦™å‘³" target="_blank">çƒŸè‰çš„é¦™å‘³</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2022 <a href="/." rel="nofollow">æ¨å®å¼ºçš„æŠ€æœ¯ç¬”è®°.</a>Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/"> äº¬ICPå¤‡2021035561å·.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸ!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>